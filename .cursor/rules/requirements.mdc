# Gasless Wallet SDK 프로젝트 규칙 문서

## 1. 코딩 스타일 및 구조

### 1.1 TypeScript 코드 스타일
- **함수형 프로그래밍**: 클래스보다는 함수형 컴포넌트와 훅 사용
- **변수 명명**: 보조 동사를 포함한 설명적 변수명 사용 (`isLoading`, `hasError`)
- **모듈화**: 코드 중복 방지를 위한 반복과 모듈화 선호
- **파일 구조**: 내보낸 컴포넌트, 하위 컴포넌트, 헬퍼, 정적 콘텐츠, 타입 순서로 구성
- **디렉토리 명명**: 소문자와 대시 사용 (`components/wallet-manager`)

### 1.2 Solidity 코드 스타일
- **버전**: Solidity ^0.8.20 사용
- **보안**: OpenZeppelin 컨트랙트 활용
- **가스 최적화**: 가스 효율성을 고려한 코드 작성
- **주석**: NatSpec 형식의 상세한 주석 작성

## 2. 아키텍처 원칙

### 2.1 스마트 컨트랙트 아키텍처
- **EIP-4337 준수**: Account Abstraction 표준 완전 준수
- **모듈화**: Paymaster, Smart Account, EntryPoint 분리
- **업그레이드 가능성**: 프록시 패턴 활용한 업그레이드 가능 설계
- **보안 우선**: 재진입 공격, 가스 한도 초과 방지

### 2.2 SDK 아키텍처
- **타입 안정성**: 모든 인터페이스에 TypeScript 타입 정의
- **에러 핸들링**: 조기 반환과 가드 클로즈 활용
- **모듈화**: 기능별 독립적 모듈 구성
- **확장성**: 플러그인 아키텍처로 확장 가능한 설계

## 3. 개발 워크플로우

### 3.1 브랜치 전략
- **Main**: 프로덕션 준비 완료 코드
- **Develop**: 개발 통합 브랜치
- **Feature**: `feature/기능명` 형식의 기능 브랜치
- **Hotfix**: `hotfix/버그명` 형식의 긴급 수정 브랜치

### 3.2 커밋 메시지
- **Conventional Commits** 스타일 사용
```
feat: 새로운 기능 추가
fix: 버그 수정
docs: 문서 수정
style: 코드 포맷팅
refactor: 코드 리팩토링
test: 테스트 추가/수정
chore: 빌드 프로세스 또는 보조 도구 변경
```

### 3.3 코드 리뷰
- **필수 리뷰**: 모든 PR은 최소 2명의 리뷰 필수
- **보안 리뷰**: 스마트 컨트랙트 변경 시 보안 전문가 리뷰
- **성능 리뷰**: 가스 최적화 및 SDK 성능 검토

## 4. 테스트 전략

### 4.1 스마트 컨트랙트 테스트
- **단위 테스트**: 모든 함수에 대한 단위 테스트 작성
- **통합 테스트**: EntryPoint와의 통합 테스트
- **시나리오 테스트**: 실제 사용 시나리오 기반 테스트
- **가스 테스트**: 가스 사용량 모니터링 테스트

### 4.2 SDK 테스트
- **단위 테스트**: Jest와 React Testing Library 사용
- **E2E 테스트**: 실제 블록체인 네트워크에서의 E2E 테스트
- **모킹**: 외부 의존성에 대한 적절한 모킹
- **커버리지**: 최소 90% 코드 커버리지 유지

## 5. 보안 가이드라인

### 5.1 스마트 컨트랙트 보안
- **재진입 공격 방지**: ReentrancyGuard 사용
- **정수 오버플로우**: SafeMath 또는 Solidity 0.8+ 내장 검사 활용
- **접근 제어**: OpenZeppelin AccessControl 사용
- **가스 한도**: DoS 공격 방지를 위한 가스 한도 설정

### 5.2 SDK 보안
- **프라이빗 키 관리**: 메모리에서 즉시 정리
- **입력 검증**: 모든 사용자 입력에 대한 엄격한 검증
- **HTTPS 통신**: 모든 네트워크 통신은 HTTPS 사용
- **의존성 관리**: 정기적인 의존성 보안 업데이트

## 6. 성능 최적화

### 6.1 가스 최적화
- **배치 트랜잭션**: 여러 트랜잭션을 하나의 UserOperation으로 처리
- **스토리지 최적화**: 스토리지 읽기/쓰기 최소화
- **이벤트 활용**: 가스 효율적인 로깅을 위한 이벤트 사용
- **라이브러리 사용**: 검증된 라이브러리 활용으로 가스 절약

### 6.2 SDK 성능
- **지연 로딩**: 동적 임포트를 통한 코드 분할
- **캐싱**: 네트워크 요청 결과 캐싱
- **배치 처리**: 여러 요청을 배치로 처리
- **메모리 관리**: 메모리 누수 방지

## 7. 환경 설정

### 7.1 개발 환경
- **Node.js**: v18+ LTS 버전 사용
- **TypeScript**: 최신 stable 버전
- **Hardhat**: 스마트 컨트랙트 개발 환경
- **ESLint/Prettier**: 코드 품질 및 포맷팅 도구

### 7.2 환경 변수 관리
- **개발 환경**: `.env.development` 파일 사용
- **테스트 환경**: `.env.test` 파일 사용
- **프로덕션 환경**: 환경 변수로 직접 주입
- **민감 정보**: 절대 저장소에 커밋하지 않음

```typescript
// 환경 변수 타입 정의 예시
interface EnvironmentConfig {
  BUNDLER_URL: string;
  PAYMASTER_ADDRESS: string;
  ENTRY_POINT_ADDRESS?: string;
  CHAIN_ID: number;
  API_KEY: string;
}
```

## 8. 문서화 규칙

### 8.1 코드 문서화
- **JSDoc**: 모든 public 함수와 클래스에 JSDoc 주석
- **README**: 각 패키지마다 상세한 README 작성
- **예제 코드**: 실제 동작하는 예제 코드 제공
- **API 문서**: 자동 생성되는 API 문서 유지

### 8.2 사용자 문서
- **시작 가이드**: 3줄 코드로 시작할 수 있는 가이드
- **통합 가이드**: 단계별 통합 가이드
- **트러블슈팅**: 자주 발생하는 문제 해결 방법
- **마이그레이션**: 버전 업그레이드 가이드

## 9. 배포 및 릴리즈

### 9.1 버전 관리
- **Semantic Versioning**: semver 규칙 준수
- **체인지로그**: 모든 변경사항 문서화
- **태깅**: Git 태그를 통한 릴리즈 관리
- **백워드 호환성**: 메이저 버전 업그레이드 시에만 Breaking Change

### 9.2 배포 프로세스
- **테스트넷 우선**: 메인넷 배포 전 테스트넷 검증
- **단계적 배포**: Canary → Beta → Stable 순서
- **롤백 계획**: 배포 실패 시 즉시 롤백 가능한 계획
- **모니터링**: 배포 후 실시간 모니터링

## 10. 멀티체인 지원 규칙

### 10.1 체인별 설정
- **설정 파일**: 체인별 독립적인 설정 파일 관리
- **가스 가격**: 체인별 동적 가스 가격 조정
- **블록 시간**: 체인별 블록 시간 고려한 타임아웃 설정
- **네트워크 ID**: 체인 ID 기반 네트워크 식별

### 10.2 호환성 보장
- **EVM 호환성**: 모든 EVM 호환 체인에서 동작 보장
- **RPC 표준**: 표준 JSON-RPC 메서드만 사용
- **가스 추정**: 체인별 가스 추정 로직 최적화
- **에러 핸들링**: 체인별 에러 응답 형식 처리

## 11. 광고 시스템 통합 규칙

### 11.1 광고 트리거 설계
- **비침해적**: 사용자 경험을 해치지 않는 광고 노출
- **선택적**: 사용자가 광고 노출을 선택할 수 있는 옵션 제공
- **추적 가능**: 광고 효과 측정을 위한 메트릭 수집
- **프라이버시**: 사용자 개인정보 보호 원칙 준수

### 11.2 수익 분배
- **투명성**: 가스비 대납과 광고 수익의 투명한 관계
- **지속 가능성**: 장기적으로 지속 가능한 수익 모델
- **인센티브**: 개발자와 사용자 모두에게 인센티브 제공
- **유연성**: 다양한 광고 형태 지원

## 12. 모니터링 및 알림

### 12.1 시스템 모니터링
- **가동률**: 99.9% 이상 가동률 목표
- **응답 시간**: 평균 응답 시간 3초 이하
- **에러율**: 1% 이하 에러율 유지
- **가스 사용량**: 실시간 가스 사용량 모니터링

### 12.2 알림 시스템
- **임계값 알림**: 설정된 임계값 초과 시 즉시 알림
- **장애 알림**: 시스템 장애 발생 시 자동 알림
- **보안 알림**: 비정상적인 활동 감지 시 알림
- **용량 알림**: 리소스 사용량 임계값 도달 시 알림

이 규칙 문서는 Gasless Wallet SDK 프로젝트의 모든 개발자가 따라야 할 기본 원칙과 가이드라인을 제시합니다. 프로젝트 진행 과정에서 필요에 따라 업데이트될 수 있습니다.